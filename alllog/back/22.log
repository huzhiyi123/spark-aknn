gist efConstruction 

for i in efConstructionlist:
efConstruction cmp gist 30
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 39040   l 10000 k 10
recall: 0.3904
totalconstructtime 26510.764598846436 kmeanspartitiontime 3288.2606983184814 localindexconstructtime 22939.42379951477 globalindexconstructtime 283.0801010131836
totalsearchtime 17182.77859687805 localsearchtime 17029.463529586792 globalsearchtime 153.31506729125977
hello world testdoublekmeansHnsw

efConstruction cmp gist 80
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 39024   l 10000 k 10
recall: 0.39024
totalconstructtime 29630.89632987976 kmeanspartitiontime 3129.324197769165 localindexconstructtime 26182.445287704468 globalindexconstructtime 319.12684440612793
totalsearchtime 20951.507806777954 localsearchtime 20787.993907928467 globalsearchtime 163.5138988494873
hello world testdoublekmeansHnsw

efConstruction cmp gist 120
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 39135   l 10000 k 10
recall: 0.39135
totalconstructtime 27205.53684234619 kmeanspartitiontime 2928.806781768799 localindexconstructtime 24066.484451293945 globalindexconstructtime 210.24560928344727
totalsearchtime 17691.627502441406 localsearchtime 17557.156324386597 globalsearchtime 134.47117805480957
hello world testdoublekmeansHnsw

efConstruction cmp gist 180
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 39047   l 10000 k 10
recall: 0.39047
totalconstructtime 33398.43797683716 kmeanspartitiontime 2069.633960723877 localindexconstructtime 31116.21928215027 globalindexconstructtime 212.5847339630127
totalsearchtime 22757.001161575317 localsearchtime 22617.135286331177 globalsearchtime 139.86587524414062
hello world testdoublekmeansHnsw

efConstruction cmp gist 200
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 39069   l 10000 k 10
recall: 0.39069
totalconstructtime 35939.401149749756 kmeanspartitiontime 2152.4970531463623 localindexconstructtime 33574.761629104614 globalindexconstructtime 212.1424674987793
totalsearchtime 24830.78384399414 localsearchtime 24698.971033096313 globalsearchtime 131.81281089782715
hello world testdoublekmeansHnsw

efConstruction cmp gist 250
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[31]
 [43]
 [28]
 [33]
 [44]] (60000, 1) (60000, 3)
centroids1 (8, 784)
centroids2 (80, 784)
print(curdf[0]),curdf.shape (2999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 38999   l 10000 k 10
recall: 0.38999
totalconstructtime 41191.80917739868 kmeanspartitiontime 2372.1156120300293 localindexconstructtime 38606.088161468506 globalindexconstructtime 213.60540390014648
totalsearchtime 29215.240955352783 localsearchtime 29064.963340759277 globalsearchtime 150.27761459350586
hello world testdoublekmeansHnsw

end efConstructionlist
 [30, 80, 120, 180, 200, 250]
mnist topkPartitionNumlist cmp 1
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
Traceback (most recent call last):
  File "/aknn/test/testdoublekmeans.py", line 466, in <module>
    testdoublekmeansHnsw()
  File "/aknn/test/testdoublekmeans.py", line 176, in testdoublekmeansHnsw
    hnsw_global_model=hnsw_global_index_wrapper(sampledf_pandas,1000000,128,featurecol='features')
  File "/aknn/kmeans_repartition_utils.py", line 177, in hnsw_global_index_wrapper
    p.add_items(data)
RuntimeError: wrong dimensionality of the vectors
maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True

kmeanspath="/aknn/kmeans/"

gistlist=["gistpartition.csv","gistcentroids2.csv","gistcentroids1.csv"]  
siftlist=["siftpartition.csv","siftcentroids1.csv","siftcentroids2.csv"]

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/data/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/data/mnist.hdf5"
# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainraten,efConstruction,usesift
    maxelement = 100000000
    k=10
    partitionnum=8
    topkPartitionNum=5
    
    sc = 1
    m = int(50)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=85
    ef = efConstruction
    usesift=Truerecall = cnt/float(l*k) 39040   l 10000 k 10
recall: 0.3904
recall = cnt/float(l*k) 39024   l 10000 k 10
recall: 0.39024
recall = cnt/float(l*k) 39135   l 10000 k 10
recall: 0.39135
recall = cnt/float(l*k) 39047   l 10000 k 10
recall: 0.39047
recall = cnt/float(l*k) 39069   l 10000 k 10
recall: 0.39069
recall = cnt/float(l*k) 38999   l 10000 k 10
recall: 0.38999
