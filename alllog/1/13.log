for i in efConstructionlist:
efConstruction cmp 5
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 91415   l 10000 k 10
recall: 0.91415
totalconstructtime 235593.26124191284 kmeanspartitiontime 140951.41911506653 localindexconstructtime 91836.5547657013 globalindexconstructtime 2805.2873611450195
totalsearchtime 26817.48628616333 localsearchtime 26661.757707595825 globalsearchtime 155.72857856750488
hello world testdoublekmeansHnsw

efConstruction cmp 10
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 91483   l 10000 k 10
recall: 0.91483
totalconstructtime 232493.69192123413 kmeanspartitiontime 140023.7295627594 localindexconstructtime 89648.9896774292 globalindexconstructtime 2820.972681045532
totalsearchtime 24931.572198867798 localsearchtime 24770.806312561035 globalsearchtime 160.7658863067627
hello world testdoublekmeansHnsw

efConstruction cmp 15
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 91375   l 10000 k 10
recall: 0.91375
totalconstructtime 229350.30007362366 kmeanspartitiontime 139538.13934326172 localindexconstructtime 86941.68329238892 globalindexconstructtime 2870.4774379730225
totalsearchtime 25366.510152816772 localsearchtime 25205.29341697693 globalsearchtime 161.21673583984375
hello world testdoublekmeansHnsw

efConstruction cmp 30
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 92713   l 10000 k 10
recall: 0.92713
totalconstructtime 242571.1691379547 kmeanspartitiontime 139717.33832359314 localindexconstructtime 100044.82078552246 globalindexconstructtime 2809.0100288391113
totalsearchtime 25088.16885948181 localsearchtime 24928.494215011597 globalsearchtime 159.67464447021484
hello world testdoublekmeansHnsw

efConstruction cmp 60
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 95440   l 10000 k 10
recall: 0.9544
totalconstructtime 315930.17768859863 kmeanspartitiontime 139111.31310462952 localindexconstructtime 174034.3689918518 globalindexconstructtime 2784.4955921173096
totalsearchtime 26557.11317062378 localsearchtime 26400.42519569397 globalsearchtime 156.68797492980957
hello world testdoublekmeansHnsw

efConstruction cmp 80
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 95962   l 10000 k 10
recall: 0.95962
totalconstructtime 375999.1879463196 kmeanspartitiontime 138548.6137866974 localindexconstructtime 234664.25704956055 globalindexconstructtime 2786.3171100616455
totalsearchtime 27128.323793411255 localsearchtime 26971.598148345947 globalsearchtime 156.72564506530762
hello world testdoublekmeansHnsw

efConstruction cmp 100
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 96098   l 10000 k 10
recall: 0.96098
totalconstructtime 419797.7523803711 kmeanspartitiontime 139837.23258972168 localindexconstructtime 277177.10161209106 globalindexconstructtime 2783.4181785583496
totalsearchtime 28199.777841567993 localsearchtime 28042.319536209106 globalsearchtime 157.45830535888672
hello world testdoublekmeansHnsw

efConstruction cmp 150
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 96481   l 10000 k 10
recall: 0.96481
totalconstructtime 541650.8076190948 kmeanspartitiontime 140027.13346481323 localindexconstructtime 398839.0302658081 globalindexconstructtime 2784.6438884735107
totalsearchtime 28119.967222213745 localsearchtime 27965.21043777466 globalsearchtime 154.7567844390869
hello world testdoublekmeansHnsw

end efConstructionlist
 [5, 10, 15, 30, 60, 80, 100, 150]
for ki in klist:
k cmp 5
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 5
recall = cnt/float(l*k) 48218   l 10000 k 5
recall: 0.96436
totalconstructtime 539076.3261318207 kmeanspartitiontime 139425.09841918945 localindexconstructtime 396852.4558544159 globalindexconstructtime 2798.771858215332
totalsearchtime 28554.527521133423 localsearchtime 28399.486541748047 globalsearchtime 155.04097938537598
hello world testdoublekmeansHnsw

k cmp 10
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 96335   l 10000 k 10
recall: 0.96335
totalconstructtime 535684.6408843994 kmeanspartitiontime 139107.30743408203 localindexconstructtime 393795.48501968384 globalindexconstructtime 2781.848430633545
totalsearchtime 28158.97536277771 localsearchtime 28003.506183624268 globalsearchtime 155.46917915344238
hello world testdoublekmeansHnsw

k cmp 20
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 20
recall = cnt/float(l*k) 191961   l 10000 k 20
recall: 0.959805
totalconstructtime 534831.8543434143 kmeanspartitiontime 138666.76092147827 localindexconstructtime 393249.43947792053 globalindexconstructtime 2915.653944015503
totalsearchtime 28370.7492351532 localsearchtime 28213.940143585205 globalsearchtime 156.80909156799316
hello world testdoublekmeansHnsw

k cmp 30
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 30
recall = cnt/float(l*k) 287689   l 10000 k 30
recall: 0.9589633333333333
totalconstructtime 538878.4055709839 kmeanspartitiontime 140157.46116638184 localindexconstructtime 395947.5336074829 globalindexconstructtime 2773.4107971191406
totalsearchtime 28387.528657913208 localsearchtime 28232.653379440308 globalsearchtime 154.8752784729004
hello world testdoublekmeansHnsw

k cmp 40
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 40
recall = cnt/float(l*k) 382293   l 10000 k 40
recall: 0.9557325
totalconstructtime 542278.382062912 kmeanspartitiontime 139989.02130126953 localindexconstructtime 399511.5849971771 globalindexconstructtime 2777.775764465332
totalsearchtime 28851.574420928955 localsearchtime 28695.878267288208 globalsearchtime 155.69615364074707
hello world testdoublekmeansHnsw

k cmp 50
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 476589   l 10000 k 50
recall: 0.953178
totalconstructtime 554866.8684959412 kmeanspartitiontime 139494.02928352356 localindexconstructtime 412596.1637496948 globalindexconstructtime 2776.6754627227783
totalsearchtime 28982.71679878235 localsearchtime 28825.642585754395 globalsearchtime 157.0742130279541
hello world testdoublekmeansHnsw

end klist
 [5, 10, 20, 30, 40, 50]
for i in efmul:
ef cmp 75
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 473081   l 10000 k 50
recall: 0.946162
totalconstructtime 542838.0091190338 kmeanspartitiontime 138668.33472251892 localindexconstructtime 401352.47325897217 globalindexconstructtime 2817.2011375427246
totalsearchtime 27688.79723548889 localsearchtime 27529.896020889282 globalsearchtime 158.90121459960938
hello world testdoublekmeansHnsw

ef cmp 150
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 482379   l 10000 k 50
recall: 0.964758
totalconstructtime 543102.7138233185 kmeanspartitiontime 139104.14099693298 localindexconstructtime 401201.6887664795 globalindexconstructtime 2796.884059906006
totalsearchtime 33886.932134628296 localsearchtime 33732.07068443298 globalsearchtime 154.8614501953125
hello world testdoublekmeansHnsw

ef cmp 200
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484149   l 10000 k 50
recall: 0.968298
totalconstructtime 535962.5060558319 kmeanspartitiontime 139350.6143093109 localindexconstructtime 393835.55245399475 globalindexconstructtime 2776.339292526245
totalsearchtime 37443.636417388916 localsearchtime 37284.218311309814 globalsearchtime 159.41810607910156
hello world testdoublekmeansHnsw

ef cmp 250
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484293   l 10000 k 50
recall: 0.968586
totalconstructtime 547339.6551609039 kmeanspartitiontime 140193.20392608643 localindexconstructtime 404149.7714519501 globalindexconstructtime 2996.6797828674316
totalsearchtime 41104.87079620361 localsearchtime 40948.46987724304 globalsearchtime 156.4009189605713
hello world testdoublekmeansHnsw

ef cmp 400
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 483900   l 10000 k 50
recall: 0.9678
totalconstructtime 548407.5548648834 kmeanspartitiontime 138715.24572372437 localindexconstructtime 406906.6653251648 globalindexconstructtime 2785.6438159942627
totalsearchtime 52256.016969680786 localsearchtime 52101.72772407532 globalsearchtime 154.28924560546875
hello world testdoublekmeansHnsw

ef cmp 500
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 485147   l 10000 k 50
recall: 0.970294
totalconstructtime 540197.9587078094 kmeanspartitiontime 138302.39057540894 localindexconstructtime 399114.86196517944 globalindexconstructtime 2780.7061672210693
totalsearchtime 58716.94493293762 localsearchtime 58558.321714401245 globalsearchtime 158.62321853637695
hello world testdoublekmeansHnsw

ef cmp 600
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484866   l 10000 k 50
recall: 0.969732
totalconstructtime 544715.6467437744 kmeanspartitiontime 138167.74988174438 localindexconstructtime 403732.98811912537 globalindexconstructtime 2814.908742904663
totalsearchtime 63994.839906692505 localsearchtime 63833.96649360657 globalsearchtime 160.8734130859375
hello world testdoublekmeansHnsw

ef cmp 750
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484134   l 10000 k 50
recall: 0.968268
totalconstructtime 544634.6790790558 kmeanspartitiontime 139652.5149345398 localindexconstructtime 402206.62355422974 globalindexconstructtime 2775.540590286255
totalsearchtime 72805.69982528687 localsearchtime 72645.13683319092 globalsearchtime 160.56299209594727
hello world testdoublekmeansHnsw

end efmullist
 [1.5, 3, 4, 5, 8, 10, 12, 15]
for i in mlist:
m cmp 10
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484859   l 10000 k 50
recall: 0.969718
totalconstructtime 426035.5603694916 kmeanspartitiontime 139586.12179756165 localindexconstructtime 283667.28258132935 globalindexconstructtime 2782.155990600586
totalsearchtime 58063.38858604431 localsearchtime 57905.33542633057 globalsearchtime 158.05315971374512
hello world testdoublekmeansHnsw

m cmp 25
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484977   l 10000 k 50
recall: 0.969954
totalconstructtime 548603.7640571594 kmeanspartitiontime 139199.5234489441 localindexconstructtime 406331.9482803345 globalindexconstructtime 3072.2923278808594
totalsearchtime 75676.84054374695 localsearchtime 75517.73452758789 globalsearchtime 159.10601615905762
hello world testdoublekmeansHnsw

m cmp 30
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484896   l 10000 k 50
recall: 0.969792
totalconstructtime 567385.9288692474 kmeanspartitiontime 138419.5294380188 localindexconstructtime 426161.14139556885 globalindexconstructtime 2805.25803565979
totalsearchtime 74476.78232192993 localsearchtime 74306.37788772583 globalsearchtime 170.40443420410156
hello world testdoublekmeansHnsw

m cmp 40
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484979   l 10000 k 50
recall: 0.969958
totalconstructtime 574352.7085781097 kmeanspartitiontime 138475.7947921753 localindexconstructtime 433095.9916114807 globalindexconstructtime 2780.9221744537354
totalsearchtime 79569.51475143433 localsearchtime 79411.93699836731 globalsearchtime 157.5777530670166
hello world testdoublekmeansHnsw

m cmp 50
/my/spark-aknn/test/testdoublekmeans.py
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 484994   l 10000 k 50
recall: 0.969988
totalconstructtime 590331.5670490265 kmeanspartitiontime 139737.5180721283 localindexconstructtime 447807.6186180115 globalindexconstructtime 2786.4303588867188
totalsearchtime 77638.95869255066 localsearchtime 77479.49361801147 globalsearchtime 159.46507453918457
hello world testdoublekmeansHnsw

end mlist
 [10, 25, 30, 40, 50]
maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3
ef = int(4*22)
sc = 1
m = int(25)
distanceFunction='cosine'
kmeanstrainrate=0.05
efConstruction=35

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/my/sift/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"

# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainraten,efConstruction
    maxelement = 100000000
    k=10
    partitionnum=8
    topkPartitionNum=4
    ef = int(4*22)
    sc = 1
    m = int(25)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=35
recall = cnt/float(l*k) 91415   l 10000 k 10
recall: 0.91415
recall = cnt/float(l*k) 91483   l 10000 k 10
recall: 0.91483
recall = cnt/float(l*k) 91375   l 10000 k 10
recall: 0.91375
recall = cnt/float(l*k) 92713   l 10000 k 10
recall: 0.92713
recall = cnt/float(l*k) 95440   l 10000 k 10
recall: 0.9544
recall = cnt/float(l*k) 95962   l 10000 k 10
recall: 0.95962
recall = cnt/float(l*k) 96098   l 10000 k 10
recall: 0.96098
recall = cnt/float(l*k) 96481   l 10000 k 10
recall: 0.96481
recall = cnt/float(l*k) 48218   l 10000 k 5
recall: 0.96436
recall = cnt/float(l*k) 96335   l 10000 k 10
recall: 0.96335
recall = cnt/float(l*k) 191961   l 10000 k 20
recall: 0.959805
recall = cnt/float(l*k) 287689   l 10000 k 30
recall: 0.9589633333333333
recall = cnt/float(l*k) 382293   l 10000 k 40
recall: 0.9557325
recall = cnt/float(l*k) 476589   l 10000 k 50
recall: 0.953178
recall = cnt/float(l*k) 473081   l 10000 k 50
recall: 0.946162
recall = cnt/float(l*k) 482379   l 10000 k 50
recall: 0.964758
recall = cnt/float(l*k) 484149   l 10000 k 50
recall: 0.968298
recall = cnt/float(l*k) 484293   l 10000 k 50
recall: 0.968586
recall = cnt/float(l*k) 483900   l 10000 k 50
recall: 0.9678
recall = cnt/float(l*k) 485147   l 10000 k 50
recall: 0.970294
recall = cnt/float(l*k) 484866   l 10000 k 50
recall: 0.969732
recall = cnt/float(l*k) 484134   l 10000 k 50
recall: 0.968268
recall = cnt/float(l*k) 484859   l 10000 k 50
recall: 0.969718
recall = cnt/float(l*k) 484977   l 10000 k 50
recall: 0.969954
recall = cnt/float(l*k) 484896   l 10000 k 50
recall: 0.969792
recall = cnt/float(l*k) 484979   l 10000 k 50
recall: 0.969958
recall = cnt/float(l*k) 484994   l 10000 k 50
recall: 0.969988
