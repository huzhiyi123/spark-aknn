/aknn/test/testdoublekmeans.py
maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainrate,efConstruction,usesift
 100000000 10 4 3 100 50 cosine 0.05 100 True
topkPartitionNum cmp 15
partitionnumreal,partitionnummap 4 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (4, 128) (20, 128)
centroids1 (4, 128)
centroids2 (20, 128)
20
len(repartitionres) 4
partitionnumreal,partitionnummap,len(partitionmap) 4 20 20
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall: 0.79189
totalconstructtime 186671.76842689514 kmeanspartitiontime 9322.935581207275 localindexconstructtime 176021.27933502197 globalindexconstructtime 1327.5535106658936
totalsearchtime 10656.338453292847 localsearchtime 10577.515363693237 globalsearchtime 78.82308959960938
hello world testdoublekmeansHnsw

topkPartitionNum cmp 20
partitionnumreal,partitionnummap 4 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (4, 128) (20, 128)
centroids1 (4, 128)
centroids2 (20, 128)
20
len(repartitionres) 4
partitionnumreal,partitionnummap,len(partitionmap) 4 20 20
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall: 0.83854
totalconstructtime 186451.30848884583 kmeanspartitiontime 8347.543001174927 localindexconstructtime 176765.58780670166 globalindexconstructtime 1338.1776809692383
totalsearchtime 10347.779989242554 localsearchtime 10267.186641693115 globalsearchtime 80.59334754943848
hello world testdoublekmeansHnsw

topkPartitionNum cmp 50
partitionnumreal,partitionnummap 4 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (4, 128) (20, 128)
centroids1 (4, 128)
centroids2 (20, 128)
20
len(repartitionres) 4
partitionnumreal,partitionnummap,len(partitionmap) 4 20 20
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall: 0.93685
totalconstructtime 183653.78880500793 kmeanspartitiontime 9523.504972457886 localindexconstructtime 172797.6517677307 globalindexconstructtime 1332.632064819336
totalsearchtime 12602.102994918823 localsearchtime 12527.380228042603 globalsearchtime 74.7227668762207
hello world testdoublekmeansHnsw

topkPartitionNum cmp 100
partitionnumreal,partitionnummap 4 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (4, 128) (20, 128)
centroids1 (4, 128)
centroids2 (20, 128)
20
len(repartitionres) 4
partitionnumreal,partitionnummap,len(partitionmap) 4 20 20
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall: 0.98342
totalconstructtime 373628.43585014343 kmeanspartitiontime 8536.837100982666 localindexconstructtime 363755.8045387268 globalindexconstructtime 1335.79421043396
totalsearchtime 18700.17957687378 localsearchtime 18620.787620544434 globalsearchtime 79.3919563293457
hello world testdoublekmeansHnsw

topkPartitionNum cmp 150
partitionnumreal,partitionnummap 4 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (4, 128) (20, 128)
centroids1 (4, 128)
centroids2 (20, 128)
20
len(repartitionres) 4
partitionnumreal,partitionnummap,len(partitionmap) 4 20 20
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall: 0.9894
totalconstructtime 568130.1774978638 kmeanspartitiontime 9739.2897605896 localindexconstructtime 557064.7745132446 globalindexconstructtime 1326.113224029541
totalsearchtime 25279.078722000122 localsearchtime 25204.61392402649 globalsearchtime 74.46479797363281
hello world testdoublekmeansHnsw

end topkPartitionNum cmp

maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True

kmeanspath="/aknn/kmeans/"

gistlist=["gistpartition.csv","gistcentroids2.csv","gistcentroids1.csv"]  
siftlist=["siftpartition.csv","siftcentroids1.csv","siftcentroids2.csv"]

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/data/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/data/mnist.hdf5"
# ef=10, efConstruction=200


recall: 0.79189
recall: 0.83854
recall: 0.93685
recall: 0.98342
recall: 0.9894
