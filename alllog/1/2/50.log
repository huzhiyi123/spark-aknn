maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainrate,efConstruction,usesift
 100000000 10 8 3 100 50 cosine 0.05 100 True
topkPartitionNum cmp 12
partitionnumreal,partitionnummap 8 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (8, 128) (40, 128)
centroids1 (8, 128)
centroids2 (40, 128)
40
len(repartitionres) 8
partitionnumreal,partitionnummap,len(partitionmap) 8 40 40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 76287   l 10000 k 10
recall: 0.76287
totalconstructtime 143226.21035575867 kmeanspartitiontime 12178.418159484863 localindexconstructtime 129671.1037158966 globalindexconstructtime 1376.6884803771973
totalsearchtime 14570.119142532349 localsearchtime 14479.127407073975 globalsearchtime 90.99173545837402
hello world testdoublekmeansHnsw

topkPartitionNum cmp 15
partitionnumreal,partitionnummap 8 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (8, 128) (40, 128)
centroids1 (8, 128)
centroids2 (40, 128)
40
len(repartitionres) 8
partitionnumreal,partitionnummap,len(partitionmap) 8 40 40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 80406   l 10000 k 10
recall: 0.80406
totalconstructtime 137561.84101104736 kmeanspartitiontime 9601.823568344116 localindexconstructtime 126574.62692260742 globalindexconstructtime 1385.3905200958252
totalsearchtime 15589.707136154175 localsearchtime 15500.14877319336 globalsearchtime 89.55836296081543
hello world testdoublekmeansHnsw

topkPartitionNum cmp 20
partitionnumreal,partitionnummap 8 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (8, 128) (40, 128)
centroids1 (8, 128)
centroids2 (40, 128)
40
len(repartitionres) 8
partitionnumreal,partitionnummap,len(partitionmap) 8 40 40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 84717   l 10000 k 10
recall: 0.84717
totalconstructtime 137220.19958496094 kmeanspartitiontime 12286.432981491089 localindexconstructtime 123470.96729278564 globalindexconstructtime 1462.799310684204
totalsearchtime 14546.857595443726 localsearchtime 14453.320503234863 globalsearchtime 93.5370922088623
hello world testdoublekmeansHnsw

topkPartitionNum cmp 30
partitionnumreal,partitionnummap 8 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1.shape,centroids2.shape (8, 128) (40, 128)
centroids1 (8, 128)
centroids2 (40, 128)
40
len(repartitionres) 8
partitionnumreal,partitionnummap,len(partitionmap) 8 40 40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 89566   l 10000 k 10
recall: 0.89566
totalconstructtime 136980.57293891907 kmeanspartitiontime 10881.344079971313 localindexconstructtime 124707.31568336487 globalindexconstructtime 1391.9131755828857
totalsearchtime 16037.65892982483 localsearchtime 15932.6331615448 globalsearchtime 105.0257682800293
hello world testdoublekmeansHnsw

end topkPartitionNum cmp

maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True

kmeanspath="/aknn/kmeans/"

gistlist=["gistpartition.csv","gistcentroids2.csv","gistcentroids1.csv"]  
siftlist=["siftpartition.csv","siftcentroids1.csv","siftcentroids2.csv"]

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/data/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/data/mnist.hdf5"
# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainrate,efConstruction,usesift
    maxelement = 100000000
    k=10
    partitionnum=8
    topkPartitionNum=3
    sc = 1
    m = int(50)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=100
    ef = efConstruction
    usesift=Truerecall = cnt/float(l*k) 76287   l 10000 k 10
recall: 0.76287
recall = cnt/float(l*k) 80406   l 10000 k 10
recall: 0.80406
recall = cnt/float(l*k) 84717   l 10000 k 10
recall: 0.84717
recall = cnt/float(l*k) 89566   l 10000 k 10
recall: 0.89566
