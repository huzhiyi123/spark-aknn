efConstructionlist cmp 15
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 80534   l 10000 k 10
recall: 0.80534
totalconstructtime 130093.9872264862 kmeanspartitiontime 10720.652341842651 localindexconstructtime 117660.18223762512 globalindexconstructtime 1713.1526470184326
totalsearchtime 18317.649126052856 localsearchtime 18222.70441055298 globalsearchtime 94.94471549987793
hello world testdoublekmeansHnsw

efConstructionlist cmp 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 84328   l 10000 k 10
recall: 0.84328
totalconstructtime 127114.7849559784 kmeanspartitiontime 9835.603713989258 localindexconstructtime 115483.34193229675 globalindexconstructtime 1795.8393096923828
totalsearchtime 17291.651248931885 localsearchtime 17186.259508132935 globalsearchtime 105.3917407989502
hello world testdoublekmeansHnsw

efConstructionlist cmp 50
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 93486   l 10000 k 10
recall: 0.93486
totalconstructtime 105817.22593307495 kmeanspartitiontime 9755.872964859009 localindexconstructtime 94715.50750732422 globalindexconstructtime 1345.8454608917236
totalsearchtime 13175.058841705322 localsearchtime 13093.650817871094 globalsearchtime 81.40802383422852
hello world testdoublekmeansHnsw

efConstructionlist cmp 100
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 97415   l 10000 k 10
recall: 0.97415
totalconstructtime 200721.61149978638 kmeanspartitiontime 8710.143566131592 localindexconstructtime 190687.03603744507 globalindexconstructtime 1324.4318962097168
totalsearchtime 16560.057163238525 localsearchtime 16483.36386680603 globalsearchtime 76.69329643249512
hello world testdoublekmeansHnsw

efConstructionlist cmp 150
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 97743   l 10000 k 10
recall: 0.97743
totalconstructtime 287041.0008430481 kmeanspartitiontime 8632.095098495483 localindexconstructtime 277086.8628025055 globalindexconstructtime 1322.0429420471191
totalsearchtime 20700.74200630188 localsearchtime 20627.018690109253 globalsearchtime 73.72331619262695
hello world testdoublekmeansHnsw

efConstructionlist cmp 200
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 97787   l 10000 k 10
recall: 0.97787
totalconstructtime 370311.5589618683 kmeanspartitiontime 8113.791227340698 localindexconstructtime 360870.28670310974 globalindexconstructtime 1327.4810314178467
totalsearchtime 25063.828468322754 localsearchtime 24988.8117313385 globalsearchtime 75.01673698425293
hello world testdoublekmeansHnsw

end efConstructionlist cmp

klist cmp 5
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 5
recall = cnt/float(l*k) 48725   l 10000 k 5
recall: 0.9745
totalconstructtime 198872.85804748535 kmeanspartitiontime 9137.22276687622 localindexconstructtime 188424.94344711304 globalindexconstructtime 1310.6918334960938
totalsearchtime 16505.167722702026 localsearchtime 16432.843685150146 globalsearchtime 72.32403755187988
hello world testdoublekmeansHnsw

klist cmp 10
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 97477   l 10000 k 10
recall: 0.97477
totalconstructtime 203140.94972610474 kmeanspartitiontime 8633.126020431519 localindexconstructtime 193191.9708251953 globalindexconstructtime 1315.8528804779053
totalsearchtime 16658.191204071045 localsearchtime 16583.01281929016 globalsearchtime 75.17838478088379
hello world testdoublekmeansHnsw

klist cmp 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 20
recall = cnt/float(l*k) 194401   l 10000 k 20
recall: 0.972005
totalconstructtime 202366.67394638062 kmeanspartitiontime 9346.620559692383 localindexconstructtime 191693.41659545898 globalindexconstructtime 1326.636791229248
totalsearchtime 16898.74315261841 localsearchtime 16819.10252571106 globalsearchtime 79.64062690734863
hello world testdoublekmeansHnsw

klist cmp 30
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 30
recall = cnt/float(l*k) 290704   l 10000 k 30
recall: 0.9690133333333333
totalconstructtime 199564.18585777283 kmeanspartitiontime 8346.885204315186 localindexconstructtime 189878.80182266235 globalindexconstructtime 1338.498830795288
totalsearchtime 17391.818284988403 localsearchtime 17304.858446121216 globalsearchtime 86.9598388671875
hello world testdoublekmeansHnsw

klist cmp 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 40
recall = cnt/float(l*k) 386520   l 10000 k 40
recall: 0.9663
totalconstructtime 203312.19148635864 kmeanspartitiontime 9406.827449798584 localindexconstructtime 192581.00581169128 globalindexconstructtime 1324.3582248687744
totalsearchtime 17180.930614471436 localsearchtime 17103.228330612183 globalsearchtime 77.70228385925293
hello world testdoublekmeansHnsw

klist cmp 50
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[20]
 [13]
 [13]
 [13]
 [28]] (1000000, 1) (1000000, 3)
centroids1 (8, 128)
centroids2 (40, 128)
40
print(curdf[0]),curdf.shape (50000,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 481748   l 10000 k 50
recall: 0.963496
totalconstructtime 201485.37874221802 kmeanspartitiontime 8340.530157089233 localindexconstructtime 191833.43148231506 globalindexconstructtime 1311.4171028137207
totalsearchtime 16623.82411956787 localsearchtime 16542.9904460907 globalsearchtime 80.83367347717285
hello world testdoublekmeansHnsw

end klist cmp
 50
maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True

kmeanspath="/aknn/kmeans/"

gistlist=["gistpartition.csv","gistcentroids2.csv","gistcentroids1.csv"]  
siftlist=["siftpartition.csv","siftcentroids1.csv","siftcentroids2.csv"]

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/data/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/data/mnist.hdf5"
# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainraten,efConstruction,usesift
    maxelement = 100000000
    k=10
    partitionnum=8
    topkPartitionNum=3
    sc = 1
    m = int(50)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=100
    ef = efConstruction
    usesift=Truerecall = cnt/float(l*k) 80534   l 10000 k 10
recall: 0.80534
recall = cnt/float(l*k) 84328   l 10000 k 10
recall: 0.84328
recall = cnt/float(l*k) 93486   l 10000 k 10
recall: 0.93486
recall = cnt/float(l*k) 97415   l 10000 k 10
recall: 0.97415
recall = cnt/float(l*k) 97743   l 10000 k 10
recall: 0.97743
recall = cnt/float(l*k) 97787   l 10000 k 10
recall: 0.97787
recall = cnt/float(l*k) 48725   l 10000 k 5
recall: 0.9745
recall = cnt/float(l*k) 97477   l 10000 k 10
recall: 0.97477
recall = cnt/float(l*k) 194401   l 10000 k 20
recall: 0.972005
recall = cnt/float(l*k) 290704   l 10000 k 30
recall: 0.9690133333333333
recall = cnt/float(l*k) 386520   l 10000 k 40
recall: 0.9663
recall = cnt/float(l*k) 481748   l 10000 k 50
recall: 0.963496
