gist efConstruction 

klist cmp 5
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 5
recall = cnt/float(l*k) 49220   l 10000 k 5
recall: 0.9844
totalconstructtime 390911.3738536835 kmeanspartitiontime 9405.54690361023 localindexconstructtime 380182.6412677765 globalindexconstructtime 1323.185682296753
totalsearchtime 19649.88374710083 localsearchtime 19577.759742736816 globalsearchtime 72.12400436401367
hello world testdoublekmeansHnsw

klist cmp 10
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 98347   l 10000 k 10
recall: 0.98347
totalconstructtime 392826.62868499756 kmeanspartitiontime 8361.092805862427 localindexconstructtime 383129.07552719116 globalindexconstructtime 1336.4603519439697
totalsearchtime 18657.324075698853 localsearchtime 18582.711696624756 globalsearchtime 74.61237907409668
hello world testdoublekmeansHnsw

klist cmp 20
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 20
recall = cnt/float(l*k) 195939   l 10000 k 20
recall: 0.979695
totalconstructtime 398215.45577049255 kmeanspartitiontime 9496.725082397461 localindexconstructtime 387385.04576683044 globalindexconstructtime 1333.6849212646484
totalsearchtime 19561.66386604309 localsearchtime 19487.226963043213 globalsearchtime 74.43690299987793
hello world testdoublekmeansHnsw

klist cmp 30
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 30
recall = cnt/float(l*k) 293174   l 10000 k 30
recall: 0.9772466666666667
totalconstructtime 392345.2322483063 kmeanspartitiontime 8293.58196258545 localindexconstructtime 382727.02741622925 globalindexconstructtime 1324.6228694915771
totalsearchtime 18735.215425491333 localsearchtime 18658.666849136353 globalsearchtime 76.54857635498047
hello world testdoublekmeansHnsw

klist cmp 40
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 40
recall = cnt/float(l*k) 389646   l 10000 k 40
recall: 0.974115
totalconstructtime 399753.6427974701 kmeanspartitiontime 9636.8727684021 localindexconstructtime 388786.5846157074 globalindexconstructtime 1330.1854133605957
totalsearchtime 19724.57480430603 localsearchtime 19649.07956123352 globalsearchtime 75.49524307250977
hello world testdoublekmeansHnsw

klist cmp 50
type(tmp),tmp[0:100],tmp.shape <class 'numpy.ndarray'> [[7]
 [7]
 [7]
 [7]
 [2]] (1000000, 1) (1000000, 3)
centroids1 (4, 128)
centroids2 (20, 128)
print(curdf[0]),curdf.shape (49999,) <class 'pandas.core.series.Series'>
start query
result.count() 10000
end query
l 10000 k 50
recall = cnt/float(l*k) 485581   l 10000 k 50
recall: 0.971162
totalconstructtime 392609.97557640076 kmeanspartitiontime 8374.44543838501 localindexconstructtime 382927.69479751587 globalindexconstructtime 1307.835340499878
totalsearchtime 20075.934648513794 localsearchtime 20002.612113952637 globalsearchtime 73.32253456115723
hello world testdoublekmeansHnsw

end klist cmp
 50
maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True

kmeanspath="/aknn/kmeans/"

gistlist=["gistpartition.csv","gistcentroids2.csv","gistcentroids1.csv"]  
siftlist=["siftpartition.csv","siftcentroids1.csv","siftcentroids2.csv"]

"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/data/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/data/mnist.hdf5"
# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainraten,efConstruction,usesift
    maxelement = 100000000
    k=10
    partitionnum=4
    topkPartitionNum=3
    sc = 1
    m = int(50)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=85
    ef = efConstruction
    usesift=Truerecall = cnt/float(l*k) 49220   l 10000 k 5
recall: 0.9844
recall = cnt/float(l*k) 98347   l 10000 k 10
recall: 0.98347
recall = cnt/float(l*k) 195939   l 10000 k 20
recall: 0.979695
recall = cnt/float(l*k) 293174   l 10000 k 30
recall: 0.9772466666666667
recall = cnt/float(l*k) 389646   l 10000 k 40
recall: 0.974115
recall = cnt/float(l*k) 485581   l 10000 k 50
recall: 0.971162
