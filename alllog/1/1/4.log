start efConstruction=250 

start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 96959   l 10000 k 10
recall: 0.96959
totalconstructtime 631164.8938655853 kmeanspartitiontime 101793.7204837799 localindexconstructtime 527306.1153888702 globalindexconstructtime 2065.0579929351807
totalsearchtime 32980.03005981445 localsearchtime 32857.820987701416 globalsearchtime 122.20907211303711
hello world testdoublekmeansHnsw

start efConstruction=300 

start query
result.count() 10000
end query
l 10000 k 10
recall = cnt/float(l*k) 97063   l 10000 k 10
recall: 0.97063
totalconstructtime 697588.0122184753 kmeanspartitiontime 102291.36347770691 localindexconstructtime 593275.6571769714 globalindexconstructtime 2020.991563796997
totalsearchtime 40443.907022476196 localsearchtime 40319.851875305176 globalsearchtime 124.05514717102051
hello world testdoublekmeansHnsw

gist efConstruction 

gist efConstruction cmp 50
<class 'h5py._hl.files.File'>
<KeysViewHDF5 ['distances', 'neighbors', 'test', 'train']>
Traceback (most recent call last):
  File "/tmp/data/newaknn/test/testdoublekmeans.py", line 411, in <module>
    testdoublekmeansHnsw()
  File "/tmp/data/newaknn/test/testdoublekmeans.py", line 144, in testdoublekmeansHnsw
    words_df = sql_context.createDataFrame(df,curschema)
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/sql/context.py", line 307, in createDataFrame
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/sql/session.py", line 748, in createDataFrame
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/sql/session.py", line 430, in _createFromLocal
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/context.py", line 527, in parallelize
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/context.py", line 562, in _serialize_to_jvm
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/context.py", line 522, in reader_func
  File "/usr/spark-2.4.1/python/lib/py4j-0.10.7-src.zip/py4j/java_gateway.py", line 1257, in __call__
  File "/usr/spark-2.4.1/python/lib/pyspark.zip/pyspark/sql/utils.py", line 63, in deco
    print("Adding first batch of %d elements" % (len(data)))
  File "/usr/spark-2.4.1/python/lib/py4j-0.10.7-src.zip/py4j/protocol.py", line 328, in get_return_value
py4j.protocol.Py4JJavaError: An error occurred while calling z:org.apache.spark.api.python.PythonRDD.readRDDFromFile.
: java.lang.OutOfMemoryError: Java heap space
	at org.apache.spark.api.python.PythonRDD$.readRDDFromInputStream(PythonRDD.scala:188)
	at org.apache.spark.api.python.PythonRDD$.readRDDFromFile(PythonRDD.scala:175)
	at org.apache.spark.api.python.PythonRDD.readRDDFromFile(PythonRDD.scala)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.GatewayConnection.run(GatewayConnection.java:238)
	at java.lang.Thread.run(Thread.java:748)

maxelement = 100000000
k=10
partitionnum=8
topkPartitionNum=3

sc = 1
m = int(50)
distanceFunction='cosine'
kmeanstrainrate=0.05

efConstruction=35
ef = int(4*22)
usesift=True


"""
datapath="/my/siftsmall/"
traindatapath=datapath+"siftsmall_base.fvecs"
querydatapath=datapath+"siftsmall_query.fvecs"
querygroundtruthpath=datapath+"siftsmall_groundtruth.ivecs"
"""
datapath="/my/sift/"
traindatapath=datapath+"sift_base.fvecs"
querydatapath=datapath+"sift_query.fvecs"
querygroundtruthpath=datapath+"sift_groundtruth.ivecs"


gistpath="/sift/gist-960-euclidean.hdf5"
# ef=10, efConstruction=200


def initparams():
    global maxelement,k,partitionnum,topkPartitionNum,ef,m,distanceFunction,kmeanstrainraten,efConstruction,usesift
    maxelement = 100000000
    k=10
    partitionnum=8
    topkPartitionNum=5
    
    sc = 1
    m = int(50)
    distanceFunction='cosine'
    kmeanstrainrate=0.05
    efConstruction=85
    ef = efConstruction
    usesift=Truerecall = cnt/float(l*k) 96959   l 10000 k 10
recall: 0.96959
recall = cnt/float(l*k) 97063   l 10000 k 10
recall: 0.97063
